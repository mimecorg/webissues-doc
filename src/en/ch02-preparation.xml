<chapter id="webissues.prep">
  <title>Preparing the system</title>

  <para>In order to use the WebIssues system, it's necessary to configure a server which is its central and most important part. This chapter describes a step-by-step process of installing the WebIssues server and preparing it to work. If you use an already existing server, you can skip this chapter. For more information on updating the system to a new version refer to <xref linkend="webissues.admin.updating"/>.</para>

  <sect1 id="webissues.prep.requirements">
    <title>Requirements</title>

    <para>You can install WebIssues server software on a computer with Unix/Linux, OS X or Windows operating system. Before installing you will need the following components:</para>

    <itemizedlist>
      <listitem>
        <para>A web server</para>
      </listitem>
      <listitem>
        <para>A database server</para>
      </listitem>
      <listitem>
        <para>PHP</para>
      </listitem>
    </itemizedlist>

    <para>You can use the Apache web server that runs on almost all operating systems (version 2.0 or later is recommended). You can also use the Microsoft IIS server which is part of Windows (version 7.0 or later is recommended).</para>

    <para>One of the following database server is required:</para>

    <itemizedlist>
      <listitem>
        <para>MySQL (version 5.0.15 or newer)</para>
      </listitem>
      <listitem>
        <para>PostgreSQL (version 8.0 or newer)</para>
      </listitem>
      <listitem>
        <para>Microsoft SQL Server (version 2005 or newer)</para>
      </listitem>
    </itemizedlist>

    <para>In order to install the system, you must create a database on one of these servers and a user account with sufficient permissions to create tables and indexes in the database.</para>

    <para>In case of MySQL support for the InnoDB engine is required. The PostgreSQL database should be created with Unicode character encoding. Also remember that you can only use the SQL Server database if the WebIssues server is installed on a computer running Windows.</para>

    <para>The WebIssues server also requires PHP, version 5.2.1 or newer, integrated with the web server. In case of IIS server, to get the best performance it's recommended to use the <literal>fastcgi</literal> module and the <literal>wincache</literal> extension. PHP must also have the <literal>mbstring</literal> extension installed, and if you're using a MySQL or PostrgreSQL database, also the <literal>mysqli</literal> or <literal>pgsql</literal> extension, respectively.</para>

    <para>If you're installing the WebIssues server using an external web hosting service, make sure that it meets all these requirements. To create a database and configure the web server, use the tools provided by hosting provider and refer to the available documentation.</para>

    <warning>
      <title>Warning</title>
      <para>Some hosting services may have a specific configuration or other restrictions which make it difficult or even impossible to correctly install WebIssues server. They may, for example, limit the amount of available memory, the database size, or the size of files uploaded to the server.</para>
    </warning>

    <para>Before installing the WebIssues server on your computer (for personal or testing purposes) or on a computer that belongs to your company or organization, install and configure the necessary components, and then create a database using the appropriate administrative tools. Refer to the documentation of these tools to get more information about them. More information about creating databases and configuring the web server can be found at <ulink url="http://wiki.mimec.org/wiki/WebIssues/Installation"/>.</para>

  </sect1>

  <sect1 id="webissues.prep.installation">
    <title>Installation</title>

    <para>After ensuring that the required components are installed and configured, and creating the database, you can proceed to the installation of the WebIssues server itself.</para>

    <sect2 id="webissues.prep.installation.files">
      <title>Copying files</title>

      <para>Download and unpack the WebIssues server package &mdash; it contains a directory named <literal>webissues-x.y</literal> (where <literal>x.y</literal> is the version of the package). Then move all files and subdirectories from that directory to the root directory of the web server. External hosting services usually use the FTP protocol for copying files to the server, so you'll need an FTP client.</para>

      <note>
        <title>Note</title>
        <para>It's possible to install WebIssues server along with the other web sites and applications operating on the same computer. You can install the server in a subdirectory located in the root directory of the web server, as well as on a virtual host or in a virtual directory. Refer to the documentation of your web server or hosting service for more information.</para>
        <para>You can also create multiple separate instances of the WebIssues server in a single installation. Individual instances can be accessed through different domain names or subdomains, or in different virtual subdirectories. For more information, please visit <ulink url="http://wiki.mimec.org/wiki/WebIssues/Configuration"/>.</para>
      </note>

      <para>Then give all users, or user which the HTTP service runs as, write permission to the <filename>date/sites</filename> subdirectory. To do this use the file manager or the FTP client, or run the <literal>chmod</literal> command from the command line. A configuration file will be created in this directory during the installation. Also files attached to the issues will be stored there.</para>

      <warning>
        <title>Warning</title>
        <para>Make sure the <filename>data</filename> and <filename>common/data</filename> directories are protected from unauthorized access using the web browser. Otherwise unauthorized persons will be able, for example, to download attachments stored in the system. If you're using Apache, you can also use the <filename>.htaccess</filename> files which are included in the source package for that purpose. For more information, please visit <ulink url="http://wiki.mimec.org/wiki/WebIssues/Installation"/>.</para>
        <para>After the installation, also make sure that the WebIssues system configuration file is protected against unauthorized access, since it contains the username and password used to connect to the database. This is particularly important when using public hosting services.</para>
        <para>To ensure maximum security it's recommended that configuration files and attachments were not stored in <filename>date</filename>, but in a different location, outside the root directory of the web server. More information about changing the location of the directory containing these files can be found at <ulink url="http://wiki.mimec.org/wiki/WebIssues/Configuration"/>.</para>
      </warning>

    </sect2>

    <sect2 id="webissues.prep.installation.setup">
      <title>System setup</title>

      <para>Now you can open the homepage of the WebIssues system. Launch your favorite web browser and enter the URL of the server, for example <literal>http://www.example.com</literal>. You should see the following message:</para>

      <figure>
        <title>Welcome message</title>
        <mediaobject>
          <imageobject><imagedata fileref="images/ch02-fig01.png" format="PNG"/></imageobject>
        </mediaobject>
      </figure>

      <para>If you follow the instructions and click on the link, you will be prompted for the language that will be used during the installation. It will also be the default language in which the WebIssues system will display all messages.</para>

      <para>In the next step of the installation, basic information about your server will be displayed: the name of the instance (usually <literal>default</literal>, unless you create multiple instances of the server within a single installation), the base URL of the server and the path of the directory in which the configuration file will be created. You will also see the version of PHP, the web server and the operating system and the name of the computer on which you're installing WebIssues. After verifying this information, go to the next step.</para>

      <figure>
        <title>Configuring the database connection</title>
        <mediaobject>
          <imageobject><imagedata fileref="images/ch02-fig02.png" format="PNG"/></imageobject>
        </mediaobject>
      </figure>

      <para>You will be asked to enter information necessary to connect to the database that you previously created. You must first determine its type; depending on your PHP configuration, you can choose a MySQL, PostgreSQL or SQL Server database. If any of these options is available, it means that the required PHP extension is not installed or is disabled.</para>

      <para>Then enter the host name of the database server, if it's located on a different computer than the web server, the name of the database and the login and password of a user with the right to create tables in the database. In case of SQL Server, you can leave the user name and password blank to use integrated Windows authentication.</para>

      <note>
        <title>Note</title>
        <para>During installation, you can also specify a prefix to be added before the names of all tables and other objects in the database. For example, if you choose <literal>wi_</literal>prefix, tables named <literal>wi_server</literal>, <literal>wi_users</literal>, etc., will be created.</para>
        <para>By choosing a unique prefix, you can install many different applications using a single database. You can also create several separate instances of the WebIssues server in a single database.</para>
      </note>

      <para>Enter the necessary information and proceed to the next step. The WebIssues system will try to connect to the database server and in case of an error will display an appropriate message. If the connection succeeds and the database doesn't already contain the tables required by the system, you will see the following page:</para>

      <figure>
        <title>Parameters of the new server</title>
        <mediaobject>
          <imageobject><imagedata fileref="images/ch02-fig03.png" format="PNG"/></imageobject>
        </mediaobject>
      </figure>

      <para>Enter the name of the server which will be visible to all users in the upper left corner of the page. Also enter the password for the Administrator account, which you can later use to log into the server and change its settings.</para>

      <para>By default, the installer will create several predefined types of issues and views. You should leave this setting to quickly start working with the system. Later you will will be able to freely adjust and even remove those built-in types. However, if you want to manually create all types of issues from scratch, select <guilabel>Do not install any issue types</guilabel>.</para>

      <note>
        <title>Note</title>
        <para>You can import data from version 0.8.5 of the WebIssues server to the new version of the system. The new server must be installed in the same database as its previous version. Therefore you must use a different prefix for the names of the new tables than the one that was used in version 0.8.5. Select <guilabel>Import data from WebIssues Server 0.8.5</guilabel> and optionally enter a prefix for the source tables.</para>
        <para>When installing a new server, all data stored in the database is copied, but the source tables are not modified or removed. Thus, if the import process fails, you can correct any errors and try installing the new version again. If attachments were stored in the file system, you must also copy them from the old version to the appropriate directory in the new version of the server; the installer will not do it automatically.</para>
        <para>If version 0.8.5 of the system used a version of the database earlier than the currently required version, before the installation you must first update the database to a newer version. After updating a MySQL database from a version older than 4.1, you also need to convert all text columns to binary, and then back to text with <literal>utf8</literal> encoding, in order to ensure proper encoding of text. Read <ulink url="http://dev.mysql.com/doc/refman/4.1/en/charset-conversion.html"/> for more information about converting columns.</para>
      </note>

      <para>Go to the next page, which contains a brief summary of the operations that will be performed. Click <guibutton>Install</guibutton> to begin the installation. This may take a few seconds, and in case of importing existing data, a bit longer. If the installation is successful, a message will appear.</para>

      <para>If you want to create a new configuration file for a previously created server, enter the connection parameters for the database containing data of the server instance. The page used for entering parameters of a new server will be omitted in this case, and the database will not be modified in any way. Instead, the installer will display the name and other information about the existing server, and the installation process will only create a new configuration file.</para>

      <tip>
        <title>Tip</title>
        <para>In order to create a new configuration file in the future, for example after moving the database to another server, you must first delete an existing configuration file. This is a protection against unauthorized access to the installation procedure.</para>
      </tip>

    </sect2>

  </sect1>

  <sect1 id="webissues.prep.setup">
    <title>Initial setup</title>

    <para>After installing the new WebIssues server, it contains initial configuration and settings, but before you can use it, you have to do a few more things. First, you must create accounts for users that will use the system. Secondly, you need to create projects and folders in which the issues will be stored.</para>

    <sect2 id="webissues.prep.setup.users">
      <title>User accounts</title>

      <para>Let's start with creating user accounts. Click the <guilabel>Administration Panel</guilabel> link in the upper right corner of the window, then select <guilabel>User Accounts</guilabel>. You should see a single user named Administrator, which was created by the installer.</para>

      <para>Create your personal account, so you don't have to log in as Administrator. To do this, click <guilabel>Add user</guilabel>, then enter your name and the login and password that you will be using to log into the system. Then press <guibutton>OK</guibutton>.</para>

      <figure>
        <title>Creating a user account</title>
        <mediaobject>
          <imageobject><imagedata fileref="images/ch02-fig04.png" format="PNG"/></imageobject>
        </mediaobject>
      </figure>

      <para>Repeat the above steps to create accounts for other people who will use the system. For each of them you need to specify the initial password, but for greater security, you can select the <guilabel>User must change password at next logon</guilabel> option, if you want them to set their own password when logging into the system.</para>

      <para>In the WebIssues system there may be more users with administrator privileges. To change permissions of a user, select him by clicking his name in the list, then click <guilabel>Change Access</guilabel>. You can choose the System Administrator or Regular User permission, and also disable access to the system for given user. Press <guibutton>OK</guibutton> to confirm the changes.</para>

      <tip>
        <title>Tip</title>
        <para>The System Administrator has access to the Administration Panel, and is the administrator of all existing projects, even if he's not implicitly their member. Thus grant this permission only to persons that you trust.</para>
      </tip>

      <para>A configured list of user accounts may look like the figure below:</para>

      <figure>
        <title>List of user accounts</title>
        <mediaobject>
          <imageobject><imagedata fileref="images/ch02-fig05.png" format="PNG"/></imageobject>
        </mediaobject>
      </figure>

      <para>For more information on administering user accounts, read <xref linkend="webissues.admin.users"/>.</para>

    </sect2>

    <sect2 id="webissues.prep.setup.projects">
      <title>Projects and folders</title>

      <para>Then click on the <guilabel>Web Client</guilabel> link in the upper right corner to go to the main part of the WebIssues system. On the left you'll see an empty projects and folders tree. Click <guilabel>Add Project</guilabel> to create the first project. Name it <quote>My first project</quote> and press <guibutton>OK</guibutton>.</para>

      <figure>
        <title>Creating a project</title>
        <mediaobject>
          <imageobject><imagedata fileref="images/ch02-fig06.png" format="PNG"/></imageobject>
        </mediaobject>
      </figure>

      <para>The new project will appear in the tree and will be automatically selected. On the right side there will be a number of operations that you can perform on the selected project. Let's begin by creating folders. Click <guilabel>Add Folder</guilabel> and create a folder called <quote>Bugs</quote>, selecting the type of issues with the same name.</para>

      <figure>
        <title>Creating a folder</title>
        <mediaobject>
          <imageobject><imagedata fileref="images/ch02-fig07.png" format="PNG"/></imageobject>
        </mediaobject>
      </figure>

      <para>After creating a folder, it will be displayed in the tree below the project and automatically selected. Select the project again by clicking on its name and add another folder of type Tasks. Then repeat the same step to create a Forums folder. The projects tree will look like this:</para>

      <figure>
        <title>Projects tree</title>
        <mediaobject>
          <imageobject><imagedata fileref="images/ch02-fig08.png" format="PNG"/></imageobject>
        </mediaobject>
      </figure>

      <para>For now, the newly created project is only available to system administrators. To grant access to other users, select the project and click <guilabel>Project Members</guilabel>. You will see an empty list. Now click <guilabel>Add members</guilabel> and select all users except the Administrator account. Click <guibutton>OK</guibutton>.</para>

      <para>You can also assign one of the members an administrator right for the project. Select a user and click <guilabel>Change Access</guilabel>. Then select the access level in a similar way as in case of changing user's access to the system.</para>

      <tip>
        <title>Tip</title>
        <para>Project Administrator can create and modify folders, as well as change permissions of other users for this project. He can also delete issues and delete and modify other users' comments.</para>
      </tip>

      <para>A configured list of members of the project may look like below:</para>

      <figure>
        <title>List of project members</title>
        <mediaobject>
          <imageobject><imagedata fileref="images/ch02-fig09.png" format="PNG"/></imageobject>
        </mediaobject>
      </figure>

      <para>Read <xref linkend="webissues.admin.projects"/> later in this book to learn more about administration of projects and folders.</para>

    </sect2>

  </sect1>

  <sect1 id="webissues.prep.notifications">
    <title>Email notifications</title>

    <para>The WebIssues system has the ability to send emails informing about new and changed issues in selected views. This is optional, because the configuration of your computer or hosting service doesn't always allow this and it's not needed in all cases. If you want to use email notifications, you must perform two additional configuration steps.</para>

    <sect2 id="webissues.prep.nofitications.email">
      <title>Sending emails</title>

      <para>First, go to the Administration Panel and click <guilabel>Email Settings</guilabel> to configure sending emails.</para>

      <figure>
        <title>Email settings</title>
        <mediaobject>
          <imageobject><imagedata fileref="images/ch02-fig10.png" format="PNG"/></imageobject>
        </mediaobject>
      </figure>

      <para>If PHP on your server is configured so that it has the ability to send emails using the <literal>sendmail</literal> program or a local SMTP server, select <guilabel>Standard PHP mailer</guilabel> and enter the address from which the messages will be sent.</para>

      <note>
        <title>Note</title>
        <para>For more information on setting up the standard mechanism for sending emails which is built into PHP, please visit <ulink url="http://php.net/manual/en/mail.configuration.php"/>.</para>
      </note>

      <para>You can also send emails using an external SMTP server. You can either use your company or organization's mail server, or any public email service (e.g. gmail). Select <guilabel> Custom SMTP server</guilabel> and enter the address of the sender. In the <guilabel>SMTP Server</guilabel> section, type the address of the server and the port number of the email service (usually 25 or 465 for encrypted connections). Select the encryption mode, if the SMTP server supports encrypted communication. Also enter the user name and password required to access the SMTP server.</para>

      <para>Click <guibutton>Test Connection</guibutton> to check whether the SMTP configuration is correct. The WebIssues system will send a test message to its own address. If you receive it, it means that the configuration is correct. Don't forget to save the configuration by clicking <guibutton>OK</guibutton>.</para>

    </sect2>

    <sect2 id="webissues.prep.nofitications.cron">
      <title>Cron jobs</title>

      <para>The second step is to set up a recurring task, which will send notifications. This task should be executed at least once an hour, but in order to receive immediate notification more quickly, it's recommended that this task was performed at intervals of 5 to 15 minutes.</para>

      <para>In case of Unix/Linux, you can use the <literal>cron</literal> jobs mechanism . To add a cron job, modify <filename>/etc/crontab</filename> or use a graphical tool for managing jobs. If you use Windows, open the Task Scheduler and create a new task. For more information, please visit <ulink url="http://wiki.mimec.org/wiki/WebIssues/Installation"/>.</para>

      <note>
        <title>Note</title>
        <para>Some hosting services provide the ability to define recurring tasks via shell access, or by their administration panel. Refer to the documentation of your service for more information.</para>
        <para>If your hosting service does not offer the ability to run periodic tasks, you can install such task on another computer. For example, you use one of the available online cron services &mdash; some of them are available for free.</para>
      </note>

      <para>If the job is executed locally, it should run the <literal>cron/job.php</literal> script using the PHP interpreter. For more information about running PHP from the command line, see <ulink url="http://www.php.net/manual/en/features.commandline.options.php"/>.</para>

      <para>If you use an external cron service or run the task on another computer, the script should be run remotely through its full URL, for example <literal>http://www.example.com/cron/job.php</literal>. To do this, you can for example use the <literal>wget</literal> or <literal>curl</literal> program, you can also use any web browser running in text mode.</para>

      <para>To check whether the cron job is being executed, go to the Administration Panel and click <guilabel>General Information</guilabel>. In the <guilabel>Cron Job</guilabel> section the date and time when the job was last run should be displayed. Each execution of the job is also logged in the Event Log of the WebIssues system.</para>

    </sect2>

  </sect1>

</chapter>
